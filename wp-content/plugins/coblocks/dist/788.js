"use strict";(self.webpackChunkcoblocks=self.webpackChunkcoblocks||[]).push([[788],{7788:function(e,t,l){l.r(t),l.d(t,{default:function(){return H}});var o=l(7462),n=l(9307),i=l(4184),a=l.n(i),r=l(7635),c=l(2819),s=l.n(c),u=l(5736),d=l(4333),m=l(1313),g=l(4981),p=l(2175),b=l(5609),k=l(9818);const _=e=>{let{hoveredFilter:t}=e;if(!t)return null;const l=s().cloneDeep((0,k.select)("core/block-editor").getSelectedBlock());return l.attributes.filter=t,(0,n.createElement)("div",{className:"block-editor-block-switcher__popover__preview__parent"},(0,n.createElement)("div",{className:"block-editor-block-switcher__popover__preview__container"},(0,n.createElement)(b.Popover,{className:"block-editor-block-switcher__preview__popover coblocks-image-filter-popover",focusOnMount:!1,position:"bottom right"},(0,n.createElement)("div",{className:"block-editor-block-switcher__preview coblocks__preview"},(0,n.createElement)("div",{className:"block-editor-block-switcher__preview-title"},(0,u.__)("Preview filter","coblocks")),(0,n.createElement)(p.BlockPreview,{autoHeight:!0,blocks:{...l}})))))};var v=e=>{const[t,l]=(0,n.useState)(null),o=e=>{l(e)},{attributes:i,setAttributes:c}=e,{filter:s}=i,d=[{icon:(0,n.createElement)(b.Icon,{icon:r.mJk}),isActive:"none"===s,onClick:()=>{c({filter:"none"})},slug:"none",
/* translators: image style */
title:(0,u.__)("Original","coblocks")},{icon:(0,n.createElement)(b.Icon,{icon:r.NC1}),isActive:"grayscale"===s,onClick:()=>{c({filter:"grayscale"})},slug:"grayscale",
/* translators: image style */
title:(0,u.__)("Grayscale filter","coblocks")},{icon:(0,n.createElement)(b.Icon,{icon:r.amg}),isActive:"sepia"===s,onClick:()=>{c({filter:"sepia"})},slug:"sepia",
/* translators: image style */
title:(0,u.__)("Sepia filter","coblocks")},{icon:(0,n.createElement)(b.Icon,{icon:r.swD}),isActive:"saturation"===s,onClick:()=>{c({filter:"saturation"})},slug:"saturation",
/* translators: image style */
title:(0,u.__)("Saturation filter","coblocks")},{icon:(0,n.createElement)(b.Icon,{icon:r.tu4}),isActive:"dim"===s,onClick:()=>{c({filter:"dim"})},slug:"dim",
/* translators: image style */
title:(0,u.__)("Dim filter","coblocks")},{icon:(0,n.createElement)(b.Icon,{icon:r.jZD}),isActive:"vintage"===s,onClick:()=>{c({filter:"vintage"})},slug:"vintage",
/* translators: image style */
title:(0,u.__)("Vintage filter","coblocks")}];return(0,n.createElement)(b.ToolbarGroup,null,(0,n.createElement)(b.DropdownMenu,{className:a()("components-coblocks-media-filter","none"!==s?"has-filter":""),icon:(0,n.createElement)(b.Icon,{icon:r.AF8}),label:(0,u.__)("Apply filter","coblocks"),noIcons:!0,popoverProps:{className:"components-coblocks-dropdown"}},(()=>(0,n.createElement)(b.MenuGroup,null,(0,n.createElement)(_,{hoveredFilter:t}),d.map((e=>(0,n.createElement)(b.MenuItem,{icon:e.icon,isSelected:s===e.slug,key:`coblocks-image-filter-${e.slug}`,label:e.title,onClick:e.onClick,onMouseEnter:()=>o(e.slug),onMouseLeave:()=>o(null),role:"menuitemradio"},e.title)))))))},f=e=>{const{attributes:t,innerBlocks:l}=e,{images:o}=t,i=!!o.length||!(null==l||!l.length);return(0,n.createElement)(p.BlockControls,null,i&&(0,n.createElement)(v,e))},h=l(444);const E="function"==typeof p.__experimentalUseInnerBlocksProps?p.__experimentalUseInnerBlocksProps:p.useInnerBlocksProps,C=["core/image"];function y(e){let{isHidden:t,captionFocused:l,onFocusCaption:i,className:a,value:r,placeholder:c,tagName:s,captionRef:u,...d}=e;return t?(0,n.createElement)(b.VisuallyHidden,(0,o.Z)({as:p.RichText},d)):(0,n.createElement)(p.RichText,(0,o.Z)({className:a,isSelected:l,onClick:i,placeholder:c,ref:u,tagName:s,value:r},d))}var B=e=>{const{attributes:t,isSelected:l,setAttributes:i,mediaPlaceholder:r,insertBlocksAfter:c,blockProps:s,wrapperClass:d=""}=e,{align:m,caption:b,imageCrop:k,lightbox:_}=t,{children:v,...f}=E(s,{__experimentalLayout:{alignments:[],type:"default"},allowedBlocks:C,orientation:"vertical",renderAppender:!1}),[B,I]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{l||I(!1)}),[l]),(0,n.createElement)("figure",(0,o.Z)({},f,{className:a()(s.className,{[`align${m}`]:m,"has-lightbox":_,"is-cropped":k})}),d?(0,n.createElement)(h.View,{className:a()(d)},v):{children:v},(0,n.createElement)(h.View,{className:"gallery-media-placeholder-wrapper",onClick:function(){B&&I(!1)}},r),(0,n.createElement)(y,{__unstableOnSplitAtEnd:()=>c((0,g.createBlock)("core/paragraph")),"aria-label":(0,u.__)("Gallery caption text","coblocks"),captionFocused:B,className:"blocks-gallery-caption",inlineToolbar:!0,isHidden:!l&&p.RichText.isEmpty(b),onChange:e=>i({caption:e}),onFocusCaption:function(){B||I(!0)},placeholder:(0,u.__)("Write gallery caption…","coblocks"),tagName:"figcaption",value:b}))},I=l(3264),S=l(3961);const w=[{value:1,
/* translators: abbreviation for small size */
label:(0,u.__)("S","coblocks"),tooltip:(0,u.__)("Small","coblocks")},{value:2,
/* translators: abbreviation for medium size */
label:(0,u.__)("M","coblocks"),tooltip:(0,u.__)("Medium","coblocks")},{value:3,
/* translators: abbreviation for large size */
label:(0,u.__)("L","coblocks"),tooltip:(0,u.__)("Large","coblocks")},{value:4,
/* translators: abbreviation for extra large size */
label:(0,u.__)("XL","coblocks"),tooltip:(0,u.__)("Extra Large","coblocks")}],N={value:0,label:(0,u.__)("None","coblocks"),tooltip:(0,u.__)("None","coblocks")},A={value:"custom",label:(0,n.createElement)(b.Icon,{icon:r.ewm}),tooltip:(0,u.__)("Custom","coblocks")};class x extends n.Component{render(){const{advancedMaxValue:e,advancedMinValue:t,currentOption:l,label:o,onChange:i,options:r,showAdvancedControls:s,showIcons:u,showNoneOption:d,showCustomOption:m}=this.props;let g=r||w;return d&&(g=[N,...g]),m&&(g=[...g,A]),s&&!1!==t&&!1!==e?(0,n.createElement)(b.RangeControl,{label:o,value:l,onChange:e=>i(e),min:t,max:e}):(0,n.createElement)(b.BaseControl,{id:`coblocks-option-selector-${(0,c.kebabCase)(o)}`,label:o,className:a()("coblocks-option-selector-control",{"is-custom":"custom"===l})},(0,n.createElement)(b.PanelRow,null,(0,n.createElement)(b.ButtonGroup,{"aria-label":o},g.map((e=>(0,n.createElement)(b.Tooltip,{key:`option-${e.value}`,text:e.tooltip},(0,n.createElement)(b.Button,{isSecondary:l!==e.value,isPrimary:l===e.value,"aria-pressed":l===e.value,onClick:()=>i(e.value),"aria-label":e.tooltip},u?e.icon:e.label)))))))}}const M=[{
/* translators: abbreviation for small size */
label:(0,u.__)("S","coblocks"),tooltip:(0,u.__)("Small","coblocks"),value:"small"},{
/* translators: abbreviation for medium size */
label:(0,u.__)("M","coblocks"),tooltip:(0,u.__)("Medium","coblocks"),value:"medium"},{
/* translators: abbreviation for large size */
label:(0,u.__)("L","coblocks"),tooltip:(0,u.__)("Large","coblocks"),value:"large"}];var P=e=>{const{attributes:t,setAttributes:l}=e,{align:o,gutter:i,gutterCustom:a}=t,r="full"===o?10:5;return(0,n.useEffect)((()=>{a>r&&l({gutterCustom:r})}),[a,r]),(0,n.createElement)(n.Fragment,null,(0,n.createElement)(x,{currentOption:i,label:(0,u.__)("Gutter","coblocks"),onChange:e=>l({gutter:e}),options:M,showCustomOption:!0}),"custom"===i&&(0,n.createElement)(b.RangeControl,{initialValue:0,max:r,min:0,onChange:e=>l({gutterCustom:e.toString()}),step:.1,value:parseFloat(a)||0,withInputField:!0}))},T=l(7798);function z(e){const[t,l]=(0,n.useState)([]),o=(0,k.useSelect)((t=>{if(null==e||!e.length)return[];const l=e.map((e=>e.attributes.id)).filter((e=>void 0!==e));if(0===l.length)return[];if(l.length>100){const e=[...l];let n=[];for(;e.length;){var o;const l=null!==(o=t(T.store).getMediaItems({include:e.splice(0,100).join(","),per_page:100}))&&void 0!==o?o:[];n=[...n,...l]}return n}return t(T.store).getMediaItems({include:l.join(","),per_page:100})||[]}),[e]);return(null==o?void 0:o.length)!==(null==t?void 0:t.length)||null!=o&&o.some((e=>!t.find((t=>t.id===e.id))))?(l(o),o):t}const D=["noreferrer","noopener"],L="none",F="media",O="attachment";function R(e,t){switch(t){case F:return{href:(null==e?void 0:e.source_url)||(null==e?void 0:e.url),linkDestination:"media"};case O:return{href:null==e?void 0:e.link,linkDestination:"attachment"};case L:return{href:void 0,linkDestination:"none"}}return{}}function V(e,t){let{rel:l}=t;const o=e?"_blank":void 0;let n;return n=o||l?function(e){let t=e;return void 0===e||(0,c.isEmpty)(t)||(0,c.isEmpty)(t)||((0,c.each)(D,(e=>{const l=new RegExp("\\b"+e+"\\b","gi");t=t.replace(l,"")})),t!==e&&(t=t.trim()),(0,c.isEmpty)(t)&&(t=void 0)),t}(l):void 0,{linkTarget:o,rel:n}}const G=[{label:(0,u.__)("Attachment Page","coblocks"),value:O},{label:(0,u.__)("Media File","coblocks"),value:F},{label:(0,u._x)("None","Media item link option"),value:L}];function $(e){const{attributes:t,clientId:l,isSelected:o,setAttributes:i}=e,{linkTarget:a,linkTo:r,sizeSlug:s,lightbox:d,gutter:m,gutterCustom:g,radius:_}=t,{updateBlockAttributes:v}=(0,k.useDispatch)(p.store),{createSuccessNotice:f}=(0,k.useDispatch)(S.store),{getBlock:E,getSettings:C}=(0,k.useSelect)((e=>{var t;return{getBlock:e(p.store).getBlock,getSettings:(null===(t=e(p.store))||void 0===t?void 0:t.getSettings)||{}}}),[]),y=z((0,k.useSelect)((e=>{var t;return null===(t=e(p.store).getBlock(l))||void 0===t?void 0:t.innerBlocks}),[l])),B=function(e,t,l){return(0,n.useMemo)((()=>function(){if(!e||0===e.length)return;const{imageSizes:o}=l();let n={};return t&&(n=e.reduce(((e,t)=>{if(!t.id)return e;const l=o.reduce(((e,l)=>{const o=(0,c.get)(t,["sizes",l.slug,"url"]),n=(0,c.get)(t,["media_details","sizes",l.slug,"source_url"]);return{...e,[l.slug]:o||n}}),{});return{...e,[parseInt(t.id,10)]:l}}),{})),o.filter((e=>{let{slug:t}=e;return(0,c.some)(n,(e=>e[t]))})).map((e=>{let{name:t,slug:l}=e;return{label:t,value:l}}))}()),[e,t])}(y,o,C),I=r&&"none"!==r;return(0,n.createElement)(p.InspectorControls,null,(0,n.createElement)(b.PanelBody,{title:(0,u.__)("Gallery settings","coblocks")},(0,n.createElement)(P,e),"custom"!==m&&0!==g&&(0,n.createElement)(b.RangeControl,{"aria-label":(0,u.__)("Add rounded corners to the gallery items.","coblocks"),label:(0,u.__)("Rounded corners","coblocks"),max:20,min:0,onChange:e=>{i({radius:e})},step:1,value:_}),(null==B?void 0:B.length)>0&&(0,n.createElement)(b.SelectControl,{hideCancelButton:!0,label:(0,u.__)("Image size","coblocks"),onChange:function(e){i({sizeSlug:e});const t={},o=[];E(l).innerBlocks.forEach((l=>{o.push(l.clientId);const n=l.attributes.id?(0,c.find)(y,{id:l.attributes.id}):null;t[l.clientId]=function(e,t){const l=(0,c.get)(e,["media_details","sizes",t,"source_url"]);return l?{height:void 0,sizeSlug:t,url:l,width:void 0}:{}}(n,e)})),v(o,t,!0);const n=B.find((t=>t.value===e));f((0,u.sprintf)(
/* translators: %s: image size settings */
(0,u.__)("All gallery image sizes updated to: %s","coblocks"),n.label),{id:"gallery-attributes-sizeSlug",type:"snackbar"})},options:B,value:s}),n.Platform.isWeb&&!B&&(0,n.createElement)(b.BaseControl,{className:"gallery-image-sizes"},(0,n.createElement)(b.BaseControl.VisualLabel,null,(0,u.__)("Image size","coblocks")),(0,n.createElement)(h.View,{className:"gallery-image-sizes__loading"},(0,n.createElement)(b.Spinner,null),(0,u.__)("Loading options…","coblocks"))),(0,n.createElement)(b.ToggleControl,{checked:!!d,help:e=>e?(0,u.__)("Image lightbox is enabled.","coblocks"):(0,u.__)("Toggle to enable the image lightbox.","coblocks"),label:(0,u.__)("Lightbox","coblocks"),onChange:()=>i({lightbox:!d})}),(0,n.createElement)(b.SelectControl,{hideCancelButton:!0,label:(0,u.__)("Link to","coblocks"),onChange:function(e){i({linkTo:e});const t={},o=[];E(l).innerBlocks.forEach((l=>{o.push(l.clientId);const n=l.attributes.id?(0,c.find)(y,{id:l.attributes.id}):null;t[l.clientId]=R(n,e)})),v(o,t,!0);const n=[...G].find((t=>t.value===e));f((0,u.sprintf)(
/* translators: %s: image size settings */
(0,u.__)("All gallery image links updated to: %s","coblocks"),n.label),{id:"gallery-attributes-linkTo",type:"snackbar"})},options:G,value:r}),I&&(0,n.createElement)(b.ToggleControl,{checked:"_blank"===a,label:(0,u.__)("Open in new tab","coblocks"),onChange:function(e){const t=e?"_blank":void 0;i({linkTarget:t});const o={},n=[];E(l).innerBlocks.forEach((e=>{n.push(e.clientId),o[e.clientId]=V(t,e.attributes)})),v(n,o,!0);const a=e?(0,u.__)("All gallery images updated to open in new tab","coblocks"):(0,u.__)("All gallery images updated to not open in new tab","coblocks");f(a,{id:"gallery-attributes-openInNewTab",type:"snackbar"})}})))}const U=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"large";const l=(0,c.pick)(e,["alt","id","link","caption"]);l.url=(0,c.get)(e,["sizes",t,"url"])||(0,c.get)(e,["media_details","sizes",t,"source_url"])||e.url;const o=(0,c.get)(e,["sizes","full","url"])||(0,c.get)(e,["media_details","sizes","full","source_url"]);return o&&(l.fullUrl=o),l.alt=""!==l.alt?l.alt:(0,u.__)("Image gallery image","coblocks"),l};const Z=["image"],j=n.Platform.isNative?(0,u.__)("ADD MEDIA","coblocks"):(0,u.__)("Drag images, upload new ones or select files from your library.","coblocks");var H=(0,d.compose)([b.withNotices])((function(e){const{setAttributes:t,attributes:l,className:i,clientId:s,noticeOperations:d,isSelected:_,noticeUI:v,insertBlocksAfter:h}=e,{filter:E,linkTarget:C,linkTo:y,sizeSlug:S,radius:w}=l,{__unstableMarkNextChangeAsNotPersistent:N,replaceBlocks:A,replaceInnerBlocks:x,updateBlockAttributes:M}=(0,k.useDispatch)(p.store),{getBlock:P,preferredStyle:T}=(0,k.useSelect)((e=>{var t;const l=e(p.store).getSettings().__experimentalPreferredStyleVariations;return{getBlock:e(p.store).getBlock,preferredStyle:null==l||null===(t=l.value)||void 0===t?void 0:t["core/image"]}}),[]),D=(0,k.useSelect)((e=>{var t;return null===(t=e(p.store).getBlock(s))||void 0===t?void 0:t.innerBlocks}),[s]),F=(0,n.useMemo)((()=>null==D?void 0:D.map((e=>({attributes:e.attributes,clientId:e.clientId,fromSavedContent:Boolean(e.originalContent),id:e.attributes.id,url:e.attributes.url})))),[D]);(0,n.useEffect)((()=>{var e;if(null!=l&&null!==(e=l.images)&&void 0!==e&&e.length&&(null==F||!F.length)){const e=null==l?void 0:l.images.map((e=>{var t;return(0,g.createBlock)("core/image",{alt:e.alt,caption:null===(t=e.caption)||void 0===t?void 0:t.toString(),id:parseInt(e.id),url:e.url})})),t={...l};delete t.images,delete t.gutter,delete t.gutterCustom;const o=(0,g.createBlock)("coblocks/gallery-masonry",{...t},e);A([s],o)}}),[]);const O=z(D),G=function(e,t){const[l,o]=(0,n.useState)([]);return(0,n.useMemo)((()=>function(){var n;let i=!1;const a=l.filter((t=>e.find((e=>t.clientId===e.clientId))));let r;return a.length<l.length&&(i=!0),e.forEach((e=>{e.fromSavedContent&&!a.find((t=>t.id===e.id))&&(i=!0,a.push(e))})),!t||(r=e.filter((e=>!a.find((t=>e.clientId&&t.clientId===e.clientId))&&(null==t?void 0:t.find((t=>t.id===e.id)))&&!e.fromSavedConent))),(i||(null===(n=r)||void 0===n?void 0:n.length)>0)&&o([...a,...r]),r.length>0?r:null}()),[e,t])}(F,O);function H(e){const t=e.id?(0,c.find)(O,{id:e.id}):null;let o;return o=e.className&&""!==e.className?e.className:T?`is-style-${T}`:void 0,{...U(e,S),...R(t,y),...V(C,l),className:o,sizeSlug:S}}function W(e){var t;return Z.some((t=>{var l;return 0===(null===(l=e.type)||void 0===l?void 0:l.indexOf(t))}))||0===(null===(t=e.url)||void 0===t?void 0:t.indexOf("blob:"))}(0,n.useEffect)((()=>{var e;const t={},l=[];null===(e=P(s))||void 0===e||e.innerBlocks.forEach((e=>{l.push(e.clientId),t[e.clientId]={className:"masonry-brick"}})),M(l,t,!0)}),[]),(0,n.useEffect)((()=>{null==G||G.forEach((e=>{M(e.clientId,{...H(e.attributes),align:void 0,id:e.id})}))}),[G]),(0,n.useEffect)((()=>{"0"===l.gutterCustom&&t({radius:0})}),[l.gutterCustom]),(0,n.useEffect)((()=>{var e,l,o,n,i,a;y||(N(),t({linkTo:(null===(e=window)||void 0===e||null===(l=e.wp)||void 0===l||null===(o=l.media)||void 0===o||null===(n=o.view)||void 0===n||null===(i=n.settings)||void 0===i||null===(a=i.defaultProps)||void 0===a?void 0:a.link)||L}))}),[y]);const J=!!F.length,X=J&&F.some((e=>!!e.id)),q=F.some((e=>{var t;return!e.id&&0===(null===(t=e.url)||void 0===t?void 0:t.indexOf("blob:"))})),K=(0,n.createElement)(p.MediaPlaceholder,{accept:"image/*",addToGallery:X,allowedTypes:Z,disableMediaButtons:J&&!_||q,handleUpload:!1,icon:!J&&(0,n.createElement)(b.Icon,{icon:r.$vB}),isAppender:J,labels:{instructions:!J&&j,title:!J&&(0,u.__)("Masonry Gallery","coblocks")},multiple:!0,notices:J?void 0:v,onError:function(e){d.removeAllNotices(),d.createErrorNotice(e)},onSelect:function(e){const t="[object FileList]"===Object.prototype.toString.call(e),l=t?Array.from(e).map((e=>e.url?e:U({url:(0,m.createBlobURL)(e)}))):e;t&&!l.every(W)&&(d.removeAllNotices(),d.createErrorNotice((0,u.__)("If uploading to a gallery all files need to be image formats","coblocks"),{id:"gallery-upload-invalid-file"}));const o=l.filter((e=>e.url||W(e))).map((e=>e.url?e:U({url:(0,m.createBlobURL)(e)}))),n=null==o?void 0:o.reduce(((e,t,l)=>(e[t.id]=l,e)),{}),i=t?D:D.filter((e=>o.find((t=>t.id===e.attributes.id)))),a=Array.from(e).reduce(((e,t)=>({...null!=e&&e.mime?{}:e,[`${t.id}`]:t.caption})));null==i||i.forEach((e=>{const t=a[e.attributes.id];e.attributes.caption!==t&&(e.attributes.caption=t)}));const r=o.filter((e=>!i.find((t=>e.id===t.attributes.id)))).map((e=>(0,g.createBlock)("core/image",{alt:e.alt,caption:e.caption,id:e.id,url:e.url})));x(s,(0,c.concat)(i,r).sort(((e,t)=>n[e.attributes.id]-n[t.attributes.id])))},value:X?F:{}}),Q=(0,p.useBlockProps)({className:a()(i,{[`has-filter-${E}`]:"none"!==E,[`has-border-radius-${w}`]:w>0})});return(0,n.createElement)(n.Fragment,null,_&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)(f,(0,o.Z)({},e,{innerBlocks:F})),(0,n.createElement)($,e)),v,(0,n.createElement)(I.Z,l,(0,n.createElement)(B,(0,o.Z)({},e,{blockProps:Q,images:F,insertBlocksAfter:h,mediaPlaceholder:K,wrapperClass:"masonry-grid"}))))}))}}]);